#!/bin/sh
#
# Set or get ssh pubic key of <jailname>
# Usage: key <jailname> [<keyfile>]
#

LIBDIR="$(dirname $0)" && . "${LIBDIR}/config"

jail="${1:-}"
keyfile="${2:-}"
if [ ! -n "${jail}" ]; then
    "${LIBDIR}/bkctld-help" && exit 1
fi
[ -d "${CONFDIR}/${jail}" ] || error "${jail} : inexistant jail'"

if [ -z "${keyfile}" ]; then
    if [ -f "${CONFDIR}/${jail}/ssh/authorized_keys" ]; then
        cat "${CONFDIR}/${jail}/ssh/authorized_keys"
    fi
else
    [ -e "${keyfile}" ] || error "Keyfile ${keyfile} dosen't exist !"
    cat "${keyfile}" > "${CONFDIR}/${jail}/ssh/authorized_keys"
    chmod 600 "${CONFDIR}/${jail}/ssh/authorized_keys"
    notice "${jail} : update key => ${keyfile}"
fi
